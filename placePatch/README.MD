## TIENE ERRORES. REVISAR TRANQUILO. 



# MorfometrÃ­a 3D con Parches SemiautomÃ¡ticos

Este repositorio contiene un script en R (`procesar_parches.R`) diseÃ±ado para proyectar **semilandmarks de superficie** y **curvas** sobre mÃºltiples especÃ­menes 3D, utilizando un atlas de referencia.

---

## ğŸ“‚ Estructura de carpetas sugerida

Organiza los archivos en las siguientes carpetas para facilitar el uso del script:

```
project-root/
â”œâ”€ data/
â”‚   â”œâ”€ atlas/
â”‚   â”‚   â”œâ”€ atlas_mesh.ply          # Modelo 3D del atlas
â”‚   â”‚   â”œâ”€ atlas_landmarks.tps     # Landmarks fijos del atlas
â”‚   â”‚   â””â”€ atlas_patch.tps         # Semilandmarks del parche
â”‚   â”œâ”€ targets/
â”‚   â”‚   â”œâ”€ specimen1_mesh.ply      # Modelo 3D del espÃ©cimen 1
â”‚   â”‚   â”œâ”€ specimen1_landmarks.tps # Landmarks fijos del espÃ©cimen 1
â”‚   â”‚   â”œâ”€ specimen2_mesh.ply      # Modelo 3D del espÃ©cimen 2
â”‚   â”‚   â””â”€ specimen2_landmarks.tps # Landmarks fijos del espÃ©cimen 2
â”‚
â”œâ”€ output/
â”‚   â”œâ”€ plots/                      # Capturas PNG de los especÃ­menes procesados
â”‚   â””â”€ tps/                        # Archivos TPS generados
â”‚
â”œâ”€ scripts/
â”‚   â””â”€ procesar_parches.R          # Script principal
â””â”€ README.md                       # DocumentaciÃ³n
```

---

## ğŸš€ InstalaciÃ³n de dependencias

Antes de ejecutar el script, asegÃºrate de instalar las siguientes bibliotecas en R:

```r
install.packages(c(
  "geomorph", "Morpho", "SlicerMorphR",
  "rgl", "jsonlite", "tidyverse"
))
```

---

## âš™ï¸ Uso bÃ¡sico

### 1. Definir curvas (opcional)
Si deseas incluir curvas en el anÃ¡lisis, define las listas `corrCurves` y `patchCurves` en un archivo llamado `curves_definition.R` dentro de la carpeta `data/atlas/`. Por ejemplo:

```r
# data/atlas/curves_definition.R
corrCurves <- list(
  arcoOrbitario = c(5, 12),  # Ãndices de landmarks fijos
  suturaNasal   = c(2, 8)
)

patchCurves <- list(
  arcoOrbitario = 1:15,      # Ãndices de semilandmarks
  suturaNasal   = 16:30
)
```

### 2. Ejecutar el script
Carga el script y ejecuta la funciÃ³n `procesar_parches` con los argumentos correspondientes:

```r
source("scripts/procesar_parches.R")

procesar_parches(
  atlas_ply        = "data/atlas/atlas_mesh.ply",
  atlas_land_tps   = "data/atlas/atlas_landmarks.tps",
  atlas_parche_tps = "data/atlas/atlas_patch.tps",
  targets_ply      = list.files("data/targets/", "\\.ply$", full.names = TRUE),
  targets_land_tps = list.files("data/targets/", "_landmarks\\.tps$", full.names = TRUE),
  corrCurves       = if (file.exists("data/atlas/curves_definition.R")) source("data/atlas/curves_definition.R")$corrCurves else NULL,
  patchCurves      = if (file.exists("data/atlas/curves_definition.R")) source("data/atlas/curves_definition.R")$patchCurves else NULL,
  inflate          = 5,
  output_dir       = "output/"
)
```

---

## ğŸ“‹ Salidas generadas

El script generarÃ¡ los siguientes archivos en la carpeta `output/`:

- **`output/plots/`**: Capturas PNG de cada espÃ©cimen con los semilandmarks proyectados.
- **`output/tps/`**: Archivos TPS con los semilandmarks proyectados.
- **`output/resumen.csv`**: Tabla resumen con los siguientes datos:
  - Nombre del espÃ©cimen
  - Ruta del archivo `.ply`
  - Ruta del archivo `.tps`
  - NÃºmero de landmarks fijos
  - NÃºmero de semilandmarks
  - Ruta del plot generado

---

## ğŸ·ï¸ Buenas prÃ¡cticas de nombres

Para evitar confusiones, utiliza nombres consistentes para los archivos:

- **Modelos 3D (`.ply`)**: `Genus_species_ID.ply`  
  Ejemplo: `Carterodon_sulcidens_MZUSP34767_Css.ply`

- **Landmarks fijos (`.tps`)**: `Genus_species_ID_landmarks.tps`  
  Ejemplo: `Carterodon_sulcidens_landmarks.tps`

- **Semilandmarks (`.tps`)**: `Genus_species_ID_patch.tps`  
  Ejemplo: `Carterodon_sulcidens_patch.tps`

- **Curvas (`curves_definition.R`)**: Define Ã­ndices claros y consistentes para landmarks y semilandmarks.

---

## ğŸ› ï¸ Notas adicionales

- AsegÃºrate de que los archivos `.ply` y `.tps` estÃ©n correctamente formateados y ubicados en las carpetas correspondientes.
- Si encuentras errores, verifica que las rutas de los archivos sean correctas y que las dependencias estÃ©n instaladas.

---

Â¡Listo! Ahora puedes procesar tus especÃ­menes 3D de manera eficiente y reproducible.

